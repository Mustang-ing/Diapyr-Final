<div class="header">
    <nav class="header-main" id="top_navbar">
        <div class="column-left">
            <a class="header-button left-sidebar-toggle-button {{#if embedded}}hide-streamlist-toggle-visibility{{/if}}" tabindex="0" role="button">
                <i class="zulip-icon zulip-icon-panel-left-dashed"></i>
                <i class="zulip-icon zulip-icon-panel-left"></i>
                <span class="left-sidebar-toggle-unreadcount"></span>
            </a>
            <a href="" class="brand no-style">
                <img id="realm-navbar-wide-logo" src="" alt="" class="nav-logo no-drag"/>
            </a>
            {{!-- <a href="diapyr_home" target="_blank" rel="noopener noreferrer" class="view-debate-button">
                View your debate
            </a> --}}
       
      

        

            <style>
            .diapyr-modal {
            display: none;
            position: fixed;
            z-index: 9999;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.6);
            }
            .diapyr-modal-content-wrapper {
            background-color: white;
            margin: 10% auto;
            padding: 20px;
            border-radius: 8px;
            width: 400px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.25);
            }
        </style>



            <style>
            #diapyr-dropdown {
                display: none;
                position: absolute;
                top: 100%;
                left: 0;
                min-width: 180px;
                background-color: #fff;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
                list-style: none;
                padding: 8px 0;
                margin: 8px 0 0 0;
                border-radius: 6px;
                transition: opacity 0.2s ease, transform 0.2s ease;
                z-index: 1000;
            }

            #diapyr-dropdown li {
                padding: 10px 20px;
                cursor: pointer;
                font-size: 14px;
                color: #333;
                transition: background-color 0.2s ease;
            }

            #diapyr-dropdown li:hover {
                background-color: #f0f4f8;
                color: #0056b3;
            }

            /* pour le bouton parent */
            #diapyr-toggle {
                font-weight: 500;
                display: flex;
                align-items: center;
                gap: 6px;
                color: #337ab7;
            }

            #diapyr-toggle:hover {
                text-decoration: underline;
            }
        </style>

        


        <div class="navbar-item" style="margin-left: 20px; position: relative;">
            <a href="#" id="diapyr-toggle" class="header-button" style="white-space: nowrap;">
               ‚ûï  Diapyr
            </a>
            <ul id="diapyr-dropdown">
                <li id="open-create-debate-modal">Cr√©er un d√©bat</li>
                <li id="open-join-debate-modal">Rejoindre un d√©bat</li> 
            </ul>

        </div>

        <script>
            setTimeout(function () {
                const toggle = document.getElementById("diapyr-toggle");
                const dropdown = document.getElementById("diapyr-dropdown");

                if (toggle && dropdown) {
                    toggle.addEventListener("click", function (e) {
                        e.preventDefault();
                        dropdown.style.display = dropdown.style.display === "block" ? "none" : "block";
                    });

                    document.addEventListener("click", function (e) {
                        if (!toggle.contains(e.target) && !dropdown.contains(e.target)) {
                            dropdown.style.display = "none";
                        }
                    });
                } else {
                    console.warn("üîç Bouton ou dropdown non trouv√© !");
                }
            }, 1000); // d√©lai pour laisser le DOM de Zulip se charger
    </script>


{{!--  --}}

        </div>
        <div class="column-middle" id="navbar-middle">
            <div class="column-middle-inner">
                <div id="streamlist-toggle" class="tippy-zulip-delayed-tooltip {{#if embedded}}hide-streamlist-toggle-visibility{{/if}}" data-tooltip-template-id="show-left-sidebar-tooltip-template">
                    <a class="left-sidebar-toggle-button" role="button" tabindex="0">
                        <i class="zulip-icon zulip-icon-panel-left-dashed"></i>
                        <i class="zulip-icon zulip-icon-panel-left"></i>
                        <span class="left-sidebar-toggle-unreadcount"></span>
                    </a>
                </div>
                <div class="top-navbar-container">
                    <div id="message_view_header" class="notdisplayed">
                    </div>
                    <div id="searchbox">
                        <form id="searchbox_form" class="navbar-search">
                            <div id="searchbox-input-container" class="input-append pill-container">
                                <i class="search_icon zulip-icon zulip-icon-search"></i>
                                <div class="search-input-and-pills">
                                    <div class="search-input input input-block-level home-page-input" id="search_query" type="text" data-placeholder-text="{{t 'Search' }}"
                                      autocomplete="off" contenteditable="true"></div>
                                </div>
                                <button class="search_close_button tippy-zulip-delayed-tooltip" type="button" id="search_exit" aria-label="{{t 'Exit search' }}" data-tippy-content="Close"><i class="zulip-icon zulip-icon-close" aria-hidden="true"></i></button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        <div class="column-right">
            <div class="spectator_login_buttons only-visible-for-spectators">
                <a id="login_button" class="login_button navbar-item" tabindex="0">
                    {{t 'Log in' }}
                </a>
            </div>
            <div id="help-menu" class="navbar-item">
                <a class="header-button tippy-zulip-delayed-tooltip" tabindex="0" role="button" data-tooltip-template-id="help-menu-tooltip-template">
                    <i class="zulip-icon zulip-icon-help-bigger" aria-hidden="true"></i>
                </a>
            </div>
            <div id="gear-menu" class="{{#if embedded}}hide-navbar-buttons-visibility{{/if}} navbar-item">
                <a id="settings-dropdown" tabindex="0" role="button" class="header-button tippy-zulip-delayed-tooltip" data-tooltip-template-id="gear-menu-tooltip-template">
                    <i class="zulip-icon zulip-icon-gear" aria-hidden="true"></i>
                </a>
            </div>
            <div id="personal-menu" class="hidden-for-spectators navbar-item">
                <a class="header-button tippy-zulip-delayed-tooltip" tabindex="0" role="button" data-tooltip-template-id="personal-menu-tooltip-template">
                    <img class="header-button-avatar" src="{{user_avatar}}"/>
                </a>
            </div>
            <div class="spectator_narrow_login_button only-visible-for-spectators" data-tippy-content="{{t 'Log in' }}" data-tippy-placement="bottom">
                <a id="login_button" class="header-button login_button navbar-item" tabindex="0">
                    <i class="zulip-icon zulip-icon-log-in"></i>
                </a>
            </div>
            <div id="userlist-toggle" class="hidden-for-spectators">
                <a id="userlist-toggle-button" role="button" class="header-button navbar-item" tabindex="0">
                    <i class="zulip-icon zulip-icon-user-list"></i>
                </a>
            </div>
        </div>
    </nav>
</div>


<!-- Modale Diapyr -->
<div id="diapyr-modal" class="diapyr-modal">
    <div class="diapyr-modal-content-wrapper">
        <button id="close-diapyr-modal" style="float: right;">‚úñ</button>
        <div id="diapyr-modal-content"></div>
    </div>
</div>
<script>
setTimeout(function () {
    const btnCreate = document.querySelector("#open-create-debate-modal");
    const btnJoin = document.querySelector("#open-join-debate-modal");
    const btnClose = document.querySelector("#close-diapyr-modal");


    if (btnCreate && btnJoin && btnClose) {
        btnCreate.addEventListener("click", function () {
            console.log("üü¢ Bouton 'Cr√©er un d√©bat' cliqu√©");
            openDiapyrModal("/diapyr_create_debat/");
        });

        btnJoin.addEventListener("click", function () {
            console.log("üü¢ Bouton 'Rejoindre un d√©bat' cliqu√©");
            openDiapyrModal("/diapyr_join_debat/");
        });

        btnClose.addEventListener("click", function () {
            document.getElementById("diapyr-modal").style.display = "none";
            document.getElementById("diapyr-modal-content").innerHTML = "";
        });

        // rend la fonction accessible globalement
        /* Script pour ouvrir dynamiquement une modale "Page qui s'affiche au dessus des autres" dans Zulip.
         * Permet d'ouvrir la modale avec un URL sp√©cifique. On l'utilise en l'associant √† l'objet window pour la rendre globale. On utilise fetch 
         * pour envoyer une requ√™te GET √† l'URL sp√©cifi√©, et on attend la r√©ponse. Si la r√©ponse est correcte, on injecte le contenu HTML dans la modale.
         * Si la requ√™te √©choue, on affiche un message d'erreur dans la modale. 
         * Il est important de noter que ce script doit √™tre ex√©cut√© apr√®s que les boutons soient pr√©sents dans le DOM, d'o√π l'utilisation de setTimeout.
         * @function openDiapyrModal
         * @param {string} url - L'URL du formulaire √† charger dans la modale. 
         * @returns {void}
        

        */
        window.openDiapyrModal = function (url) {
            fetch(url, {
                method: 'GET',
                credentials: 'include',
                headers: {
                    'X-Requested-With': 'XMLHttpRequest'
                }
            })
            .then(response => {
                if (!response.ok) throw new Error(`Erreur ${response.status}`);
                return response.text();
            })
            .then(html => {
                document.getElementById("diapyr-modal-content").innerHTML = html;
                document.getElementById("diapyr-modal").style.display = "block";
            })
            .catch(error => {
                console.error('Erreur lors du chargement du formulaire :', error);
                document.getElementById("diapyr-modal-content").innerHTML = "<p>Erreur de chargement du formulaire.</p>";
                document.getElementById("diapyr-modal").style.display = "block";
            });
        };
    } else {
        console.warn("‚ùå Les boutons ne sont pas encore dans le DOM !");
    }
    
}, 1000); // attend 1 seconde que Zulip charge le HTML

</script>

